# JavaScript

## Promise

Promise 是 JavaScript 中用于处理异步操作的对象,用来简化回调函数嵌套（回调地狱）的问题。

它代表了一个尚未完成但最终会完成的操作，并提供了一种机制来处理操作的结果和错误。

### Promise 状态

Promise 有三种状态，且状态一旦改变便不可逆：

> 从 `Pending` → `Fulfilled` 或 `Pending` → `Rejected`，且状态不可逆。

- **Pending（进行中）**：Promise 初始状态，尚未完成或失败
- **Fulfilled（已完成）**：异步操作成功完成，返回结果
- **Rejected（已失败）**：异步操作失败，返回原因

### Promise 创建

Promise 通过构造函数创建 接受一个**执行器函数（executor）**作为参数，执行器函数有两个参数：

- `resolve`：标记任务成功，并传递结果。
- `reject`：标记任务失败，并传递失败原因。

### Promise 方法

Promise 提供了三个主要方法：

- `.then()` - 处理成功情况
- `.catch()` - 处理失败情况
- `.finally()` - 处理结束情况

### 基本用法示例

```javascript
const promise = new Promise((resolve, reject) => {
    // 异步操作
    if (/* 操作成功 */) {
        resolve(value);
    } else {
        reject(error);
    }
});

promise
    .then(value => {
        // 处理成功
    })
    .catch(error => {
        // 处理错误
    })
    .finally(() => {
        // 总是会执行
    });
```

## JS 动画与 CSS 动画区别

### JS 动画
- 由 JavaScript 控制 DOM 元素变化产生的逐帧动画
- **优点**：
  - 可以实现任何复杂的动画效果
  - 控制能力强，可以随时暂停、播放、回放等
- **缺点**：
  - 会阻塞主进程，容易引起性能问题
  - 每次执行都会触发浏览器重绘
  - 动画复杂时会明显影响浏览器性能

### CSS 动画
- 在样式表中通过关键帧定义的补间动画
- **优点**：
  - 在浏览器的渲染线程中执行
  - 不会影响主线程代码执行
  - 性能较好，浏览器可以优化
- **缺点**：
  - 只能按照预设的动作运行
  - 灵活性较差
  - 无法动态控制动画过程

## WebSocket

WebSocket 是一个网络通信协议，具有以下主要特点：

### 基本概念
- 提供持久的、全双工的通信通道
- 允许客户端和服务器之间进行实时双向通信
- 相比传统HTTP，提供持续开放的连接，显著降低延迟

### 核心特性
1. **持久连接**
   - 建立后保持开放状态
   - 随时可进行数据收发

2. **全双工通信**
   - 双方可同时收发数据
   - 无需等待对方响应

3. **性能优势**
   - 低延迟：连接持续开放，即时传输
   - 低开销：头部信息量小，适合频繁的小数据传输

### 技术细节
- **连接建立**：通过HTTP升级请求建立
- **端口复用**：可使用标准HTTP端口(80/443)
- **安全性**：支持WSS(WebSocket Secure)加密传输

### 应用场景
- 在线聊天
- 实时游戏
- 股票行情
- 体育比分直播
- 协作工具

## 临时性死区(TDZ)

### 概念
在使用`let`/`const`声明变量之前，该变量处于"临时性死区"，访问会触发错误。

### 示例
```javascript
console.log(a);  // ReferenceError
let a = 10;
console.log(a);  // 10
```

## 倒计时精确实现

### 问题
前端倒计时可能存在偏差，主要原因：
- 用户设备性能差异
- 网络延迟
- 浏览器进程阻塞

### 解决方案
通过后端接口校准：
- 定期向服务器请求当前时间
- 根据服务器时间差校准倒计时

## 堆(Heap)与栈(Stack)对比

| 特性 | 堆(Heap) | 栈(Stack) |
|------|----------|-----------|
| 分配方式 | 动态分配 | 静态分配 |
| 内存大小 | 不固定，可动态调整 | 固定大小 |
| 访问方式 | 通过指针访问 | 先进后出(LIFO) |
| 存储内容 | 复杂数据类型(对象、数组) | 基本数据类型、函数参数 |
| 内存释放 | 需手动控制 | 自动释放 |
